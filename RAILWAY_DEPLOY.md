# üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Railway

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã:**
   ```bash
   git add .
   git commit -m "–ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é"
   git push
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   - `railway.json` - –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∑–∞–ø—É—Å–∫ `webhook_server.py`
   - `Procfile` - —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è release –∏ worker
   - `requirements.txt` - —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## –î–µ–ø–ª–æ–π –Ω–∞ Railway

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Railway CLI

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Railway CLI:**
   ```bash
   npm install -g @railway/cli
   ```

2. **–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç:**
   ```bash
   railway login
   ```

3. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç:**
   ```bash
   railway new
   ```

4. **–î–µ–ø–ª–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç:**
   ```bash
   railway up
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Railway Dashboard

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [railway.app](https://railway.app)**
2. **–ù–∞–∂–º–∏—Ç–µ "New Project"**
3. **–í—ã–±–µ—Ä–∏—Ç–µ "Deploy from GitHub repo"**
4. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `babka-bot`**
5. **Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `railway.json`**

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Railway Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Variables –∏ –¥–æ–±–∞–≤—å—Ç–µ:

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather
- `ALLOWED_USERS` - —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
- `DATABASE_URL` - URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `YOOKASSA_SHOP_ID` - ID –º–∞–≥–∞–∑–∏–Ω–∞ –≤ YooKassa
- `YOOKASSA_SECRET_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á YooKassa
- `OPENAI_API_KEY` - –∫–ª—é—á OpenAI –¥–ª—è GPT —Ñ—É–Ω–∫—Ü–∏–π
- `GCP_KEY_JSON_B64` - —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∫–ª—é—á Google Cloud (base64)
- `NANO_API_KEY` - –∫–ª—é—á API –¥–ª—è Nano
- `BG_REMOVAL_API_KEY` - –∫–ª—é—á API –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   railway logs
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:**
   ```bash
   railway status
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook endpoint:**
   - URL –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ Railway Dashboard
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/health` endpoint
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/webhook/yookassa` endpoint

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Webhook

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Telegram:

```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://your-railway-app.railway.app/webhook/telegram"}'
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **–õ–æ–≥–∏:** Railway Dashboard ‚Üí Deployments ‚Üí Logs
- **–ú–µ—Ç—Ä–∏–∫–∏:** Railway Dashboard ‚Üí Metrics
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:** Railway Dashboard ‚Üí Settings ‚Üí Variables

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `requirements.txt` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL webhook –≤ Telegram
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ webhook
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook'–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `python RUN_MIGRATIONS.py`

