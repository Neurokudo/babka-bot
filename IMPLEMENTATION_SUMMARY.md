# –°–≤–æ–¥–∫–∞ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π UI —Å–∏—Å—Ç–µ–º—ã

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–Ω–æ–ø–æ–∫ –∏ callback-–æ–≤ –≤ main.py
- –í—ã—è–≤–ª–µ–Ω–æ 89 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö callback-–æ–≤
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 31 —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
app/ui/
‚îú‚îÄ‚îÄ texts.py              # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ i18n)
‚îú‚îÄ‚îÄ callbacks.py          # –°–∏—Å—Ç–µ–º–∞ callback –¥–∞–Ω–Ω—ã—Ö —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ menu_schema.py        # –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è —Å—Ö–µ–º–∞ –º–µ–Ω—é
‚îú‚îÄ‚îÄ keyboards.py          # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä –∏–∑ —Å—Ö–µ–º—ã
‚îî‚îÄ‚îÄ legacy_mapping.py     # –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (95 callback-–æ–≤)

app/handlers/
‚îî‚îÄ‚îÄ router.py             # –ï–¥–∏–Ω—ã–π —Ä–æ—É—Ç–µ—Ä callback-–æ–≤

scripts/
‚îî‚îÄ‚îÄ dump_flow.py          # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º Mermaid

docs/                     # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ flow.mmd              # –û—Å–Ω–æ–≤–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
‚îú‚îÄ‚îÄ flow_detailed.mmd     # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å callback-–∞–º–∏
‚îú‚îÄ‚îÄ callback_analysis.md  # –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è callback-–æ–≤
‚îî‚îÄ‚îÄ node_summary.md       # –°–≤–æ–¥–∫–∞ –ø–æ —É–∑–ª–∞–º –º–µ–Ω—é
```

### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### üéØ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
- 100+ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–ª—é—á–µ–π –≤ `texts.py`
- –§—É–Ω–∫—Ü–∏—è `t()` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

#### üîó –°–∏—Å—Ç–µ–º–∞ callback –¥–∞–Ω–Ω—ã—Ö
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: `action|id|extra`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ 64 –±–∞–π—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- 95+ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

#### üìã –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è —Å—Ö–µ–º–∞ –º–µ–Ω—é
- 25+ —É–∑–ª–æ–≤ –º–µ–Ω—é –≤ `menu_schema.py`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫
- –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤

#### ‚å®Ô∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑ —Å—Ö–µ–º—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–∏—Å–∞–Ω–∏–π –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- Fallback –∫ –ø—É—Å—Ç—ã–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

#### üö¶ –ï–¥–∏–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
- 80+ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤
- –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@on_action` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 4. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ú–∞–ø–ø–∏–Ω–≥ –≤—Å–µ—Ö —Å—Ç–∞—Ä—ã—Ö callback-–æ–≤ (95 —à—Ç—É–∫)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
- –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º Mermaid
- –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è callback-–æ–≤
- –°–≤–æ–¥–∫–∞ –ø–æ —É–∑–ª–∞–º –º–µ–Ω—é
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- 13 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—â–∏—Ö –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ callback –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç—ã —Å—Ö–µ–º—ã –º–µ–Ω—é
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- **25 —Ñ–∞–π–ª–æ–≤** –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç
- **3,715 —Å—Ç—Ä–æ–∫** –∫–æ–¥–∞
- **95 callback-–æ–≤** —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é
- **25+ —É–∑–ª–æ–≤** –≤ —Å—Ö–µ–º–µ –º–µ–Ω—é
- **100+ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö** –∫–ª—é—á–µ–π

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ Callback —Å–∏—Å—Ç–µ–º–∞ (4 —Ç–µ—Å—Ç–∞)
- ‚úÖ –¢–µ–∫—Å—Ç—ã (2 —Ç–µ—Å—Ç–∞)  
- ‚úÖ –°—Ö–µ–º–∞ –º–µ–Ω—é (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (1 —Ç–µ—Å—Ç)
- ‚úÖ –†–æ—É—Ç–µ—Ä (1 —Ç–µ—Å—Ç)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2 —Ç–µ—Å—Ç–∞)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å callback-–∞–º–∏
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è callback-–æ–≤
- ‚úÖ –°–≤–æ–¥–∫–∞ –ø–æ —É–∑–ª–∞–º –º–µ–Ω—é
- ‚úÖ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ README –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

## üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏

### ‚úÖ –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è —Å—Ö–µ–º–∞ –º–µ–Ω—é
–í—Å–µ inline-–∫–Ω–æ–ø–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ `menu_schema.py`

### ‚úÖ –ï–¥–∏–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
–í—Å–µ `callback_query` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ–¥–∏–Ω —Ä–æ—É—Ç–µ—Ä –±–µ–∑ —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã—Ö `if/elif`

### ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è callback_data
- –ù–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 64 –±–∞–π—Ç–∞
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–µ–∑–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏

### ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
–¢–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫/—Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `texts.py` (–≥–æ—Ç–æ–≤—ã –∫ i18n)

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–°–∫—Ä–∏–ø—Ç `dump_flow.py` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `docs/flow.mmd` —Å —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### ‚úÖ Fallback –æ–±—Ä–∞–±–æ—Ç–∫–∞
–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π/—É—Å—Ç–∞—Ä–µ–≤—à–∏–π `callback_data` ‚Üí –ø–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üîß –ì–æ—Ç–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
python3 test_ui_system.py
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```bash
python3 scripts/dump_flow.py
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è
```python
from app.ui.menu_schema import validate_menu_schema
errors = validate_menu_schema()
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
from app.handlers.router import register_router
register_router(app)  # –ó–∞–º–µ–Ω–∞ –≤—Å–µ—Ö callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ main.py:

1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```python
   from app.handlers.router import callback_entry
   
   async def migrated_callback_handler(update, context):
       try:
           await callback_entry(update.callback_query)
       except Exception:
           await old_on_cb(update, context)  # Fallback
   
   app.add_handler(CallbackQueryHandler(migrated_callback_handler))
   ```

2. **–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**:
   ```python
   from app.handlers.router import register_router
   register_router(app)  # –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞
   ```

### –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤:

1. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç—ã –≤ `texts.py`
2. –î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª –≤ `menu_schema.py`
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ö—ç–Ω–¥–ª–µ—Ä —á–µ—Ä–µ–∑ `@on_action`

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è UI —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è:

- **–£–ø—Ä–æ—â–∞–µ—Ç** —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç** —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞–º–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π  
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç** –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç** –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- **–ü–æ–∫—Ä—ã–≤–∞–µ—Ç** —Ç–µ—Å—Ç–∞–º–∏ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **–ì–æ—Ç–æ–≤–∞** –∫ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±—Ä–∏—Ñ-–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ main.py –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.
