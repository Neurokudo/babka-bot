# 🏗️ ДИАГРАММА АРХИТЕКТУРЫ BABKA-BOT

```
                    🏠 ГЛАВНОЕ МЕНЮ
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
    🎬 СОЗДАНИЕ        🧱 LEGO           👗 ПРИМЕРОЧНАЯ
       ВИДЕО           МУЛЬТИКИ              │
        │                  │                  │
    ┌───▼───┐          ┌───▼───┐          ┌───▼───┐
    │ РЕЖИМЫ│          │ ТИПЫ  │          │ ЭТАПЫ │
    │       │          │       │          │       │
    │🧠✨ Помощник    │🧱 Сцена           │📸 Фото чел│
    │🔮 Neurokudo    │🎤 Репортаж        │👕 Фото од│
    │✏️ Ручной       │                    │✅ Результат│
    │🎲 Мемный       │                    │            │
    └───┬───┘          └───┬───┘          └──────────┘
        │                  │
    ┌───▼───┐          ┌───▼───┐
    │ СЦЕНА │          │ СЦЕНА │
    │       │          │       │
    │📝 Текст         │🧱 LEGO │
    │🧠 Улучшение     │🎭 Стиль│
    │💬 Фразы         │        │
    └───┬───┘          └───┬───┘
        │                  │
    ┌───▼───┐          ┌───▼───┐
    │ СТИЛИ │          │ ОРИЕНТ│
    │       │          │       │
    │🎬 Кино          │📱 9:16 │
    │🎭 Аниме         │🖥 16:9 │
    │🎨 Худож.        │        │
    │🏞️ Док.          │        │
    └───┬───┘          └───┬───┘
        │                  │
    ┌───▼───┐          ┌───▼───┐
    │ ОРИЕНТ│          │ АУДИО │
    │       │          │       │
    │📱 9:16          │🔊 С    │
    │🖥 16:9          │🔇 Без  │
    └───┬───┘          └───┬───┘
        │                  │
    ┌───▼───┐          ┌───▼───┐
    │ АУДИО │          │ ГЕНЕР │
    │       │          │       │
    │🔊 С    │          │🎬 Veo3│
    │🔇 Без  │          │🎥 Видео│
    └───┬───┘          └───┬───┘
        │                  │
    ┌───▼───┐              │
    │ ГЕНЕР │              │
    │       │              │
    │🎬 Veo3│◄─────────────┘
    │🎥 Видео│
    └───┬───┘
        │
    ┌───▼───┐
    │ РЕЗУЛЬ│
    │       │
    │🎥 Видео│
    │📤 Подел│
    │💾 Сохр │
    └───────┘
```

## 🔄 ПОТОКИ ДАННЫХ

```
ПОЛЬЗОВАТЕЛЬ → ТЕКСТ → GPT → СЦЕНА → СТИЛЬ → Veo3 → ВИДЕО → ПОЛЬЗОВАТЕЛЬ
     │           │       │      │      │       │      │         │
     │           │       │      │      │       │      │         │
     ▼           ▼       ▼      ▼      ▼       ▼      ▼         ▼
  КНОПКИ → СОСТОЯНИЕ → ОБРАБОТКА → JSON → API → ФАЙЛ → ОТВЕТ
```

## 🎯 СОСТОЯНИЕ ПОЛЬЗОВАТЕЛЯ

```
user_state = {
    ┌─ ОСНОВНЫЕ ПОЛЯ
    │  mode: "helper|manual|nkudo|lego|meme",
    │  scene: "текст сцены",
    │  style: "название стиля", 
    │  replica: "фраза героя",
    │  orientation: "9:16|16:9",
    │  with_audio: true|false,
    │
    ├─ ФЛАГИ ОЖИДАНИЯ
    │  awaiting_scene: true|false,
    │  awaiting_style: true|false,
    │  awaiting_replica: true|false,
    │
    ├─ NEUROKUDO
    │  nkudo_type: "single|reportage",
    │  nkudo_scene1: "сцена 1",
    │  nkudo_scene2: "сцена 2",
    │
    ├─ ПРИМЕРОЧНАЯ
    │  tryon: {
    │    stage: "idle|await_person|await_garment|confirm|after",
    │    person: bytes,
    │    garment: bytes,
    │    dressed: bytes
    │  },
    │
    └─ JSON ПРО
       jsonpro: {
         await_text: true|false,
         last_json: "json строка",
         orientation: "9:16|16:9"
       }
}
```

## 🎬 ГЕНЕРАЦИЯ ВИДЕО

```
ВХОДНЫЕ ДАННЫЕ
    │
    ▼
┌─────────────┐
│ СЦЕНА +     │
│ СТИЛЬ +     │
│ ОРИЕНТАЦИЯ +│
│ АУДИО       │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ JSON PROMPT │
│ ГЕНЕРАЦИЯ   │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ GOOGLE VEO3 │
│ API CALL    │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ ВИДЕО ФАЙЛ  │
│ СОЗДАН      │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ ОТПРАВКА    │
│ ПОЛЬЗОВАТЕЛЮ│
└─────────────┘
```

## 🔧 ИНТЕГРАЦИИ

```
BABKA-BOT
    │
    ├─ OPENAI GPT
    │  ├─ Улучшение сцен
    │  ├─ Генерация фраз
    │  └─ Обработка текста
    │
    ├─ GOOGLE VEO3
    │  ├─ Генерация видео
    │  ├─ 720p/1080p
    │  └─ С аудио/без аудио
    │
    ├─ GOOGLE IMAGEN
    │  ├─ Виртуальная примерочная
    │  ├─ Обработка фото
    │  └─ Генерация изображений
    │
    ├─ GOOGLE GEMINI
    │  ├─ Обработка изображений
    │  ├─ Анализ фото
    │  └─ Генерация контента
    │
    └─ TELEGRAM API
       ├─ Отправка сообщений
       ├─ Загрузка файлов
       └─ Обработка callback'ов
```
