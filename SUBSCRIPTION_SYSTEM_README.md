# Babka Bot ‚Äî –ú–æ–Ω–µ—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏ —Ç–∞—Ä–∏—Ñ—ã

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è
- –ö–∞–∂–¥–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–≤–∏–¥–µ–æ, —Ñ–æ—Ç–æ, –ø—Ä–∏–º–µ—Ä–æ—á–Ω–∞—è, JSON) —Å–ø–∏—Å—ã–≤–∞–µ—Ç –º–æ–Ω–µ—Ç—ã.
- –ù–∏–∫–∞–∫–∏—Ö –±–æ–Ω—É—Å–æ–≤ –∏–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —É—á—ë—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –°–±–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refund, –º–æ–Ω–µ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å.

## üíé –ú–æ–Ω–µ—Ç—ã
| –û–ø–µ—Ä–∞—Ü–∏—è | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|----------|-----------|
| –í–∏–¥–µ–æ / JSON | 10 –º–æ–Ω–µ—Ç |
| –§–æ—Ç–æ (–±—ã—Å—Ç—Ä–æ) | 1 –º–æ–Ω–µ—Ç–∞ |
| –§–æ—Ç–æ (–ø—Ä–µ–º–∏—É–º) | 2 –º–æ–Ω–µ—Ç—ã |
| –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–µ—Ä–æ—á–Ω–∞—è | 1 –º–æ–Ω–µ—Ç–∞ |

–ú–æ–Ω–µ—Ç—ã –ø–æ–ø–æ–ª–Ω—è—é—Ç—Å—è:
- —á–µ—Ä–µ–∑ —Ç–∞—Ä–∏—Ñ—ã/–∞–¥–¥–æ–Ω—ã (—Ç–∞—Ä–∏—Ñ—ã –¥–∞—é—Ç –ø–∞–∫–µ—Ç –º–æ–Ω–µ—Ç –Ω–∞ 30 –¥–Ω–µ–π, –∞–¥–¥–æ–Ω—ã ‚Äî —Ä–∞–∑–æ–≤—ã–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è);
- —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –º–æ–Ω–µ—Ç (20/50/100 –∏ —Ç.–¥.).

## üìã –¢–∞—Ä–∏—Ñ—ã
- ¬´–õ–∞–π—Ç¬ª ‚Äî 1 990 ‚ÇΩ ‚Üí 120 –º–æ–Ω–µ—Ç.
- ¬´–°—Ç–∞–Ω–¥–∞—Ä—Ç¬ª ‚Äî 2 490 ‚ÇΩ ‚Üí 210 –º–æ–Ω–µ—Ç.
- ¬´–ü—Ä–æ¬ª ‚Äî 4 990 ‚ÇΩ ‚Üí 440 –º–æ–Ω–µ—Ç.
- –¢–∞—Ä–∏—Ñ –¥–µ–π—Å—Ç–≤—É–µ—Ç 30 –¥–Ω–µ–π –∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç –º–æ–Ω–µ—Ç—ã –∫ –±–∞–ª–∞–Ω—Å—É. –ü–ª–∞–Ω (`plan`, `plan_expiry`) –Ω—É–∂–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∞–∫—Ü–∏–π.

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
### `users`
- `coins` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å.
- `admin_coins` ‚Äî —Å–ª—É–∂–µ–±–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –∞–¥–º–∏–Ω–∞.
- `plan`, `plan_expiry` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∏ –µ–≥–æ —Å—Ä–æ–∫.

### `transactions`
- –•—Ä–∞–Ω—è—Ç —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–∞–Ω–∏—è (`operation_type`: `video`, `photo`, `tryon`, `json`, `refund`).
- `coins_spent` ‚Äî –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ (–¥–ª—è `refund` ‚Äî –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).
- `status` ‚Äî `pending` / `completed` / `refunded`.

### `payments`
- –ü–ª–∞—Ç–µ–∂–∏ YooKassa (`id`, `user_id`, `subscription_type`, `amount`, `status`, `created_at`, `idempotent_key`).

## üîÅ Refund
–ï—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–ø–∞–ª–∞:
1. `on_error` –ø–æ–º–µ—á–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∫–∞–∫ `refunded`.
2. `add_refund_transaction` –ª–æ–≥–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç —Å –∏—Å—Ö–æ–¥–Ω—ã–º `transaction_id`.
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç –º–æ–Ω–µ—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –∏ –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

## ‚öôÔ∏è –ö–æ–¥
- `billing.py` ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Å–ø–∏—Å–∞–Ω–∏–π/–≤–æ–∑–≤—Ä–∞—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏ –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏.
- `main.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç—ã –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö (`can_generate_*`) –∏ –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –±–æ–Ω—É—Å–æ–≤.

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏
- Unit-—Ç–µ—Å—Ç—ã (`tests/test_billing.py`) –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∏ refund.
- `pytest tests/test_billing.py -v` ‚Äî –±—ã—Å—Ç—Ä—ã–π —Ä–µ–≥—Ä–µ—Å—Å (–Ω—É–∂–µ–Ω `pytest`).

## üîê –ê–¥–º–∏–Ω—Å–∫–æ–µ
- –ö–æ–º–∞–Ω–¥—ã `/add_bonus`, `/reload_profile`, `/reset_my_profile` —Ä–∞–±–æ—Ç–∞—é—Ç —Å `admin_coins` –∏ –æ–±—â–∏–º –±–∞–ª–∞–Ω—Å–æ–º.
- `admin_coins` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

## üßæ –ò—Ç–æ–≥
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç —É–π–¥—ë—Ç.
- –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ = –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç.
- –¢–∞—Ä–∏—Ñ—ã = –º–æ–Ω–µ—Ç–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –Ω–∞ 30 –¥–Ω–µ–π.
