version: 1
project:
  name: Babka Bot
  description: Telegram-платформа для генерации видео, фото и виртуальной примерки на базе OpenAI + Vertex AI + YooKassa.
  primary_language: python
  entry_points:
    - main.py
    - webhook_server.py
  infrastructure:
    - Procfile
    - railway.json
    - render.yaml
environment:
  python: 3.11
  package_manager: pip
  dependency_file: requirements.txt
  run_commands:
    # локальный запуск телеграм-бота
    bot: python main.py
    # запуск вебхук-сервера
    webhook: python webhook_server.py
    # прогон платежных e2e-тестов (требует тестовых ключей)
    payments: python test_complete_payment_system.py
    # базовые unit-тесты (добавить по мере разработки)
    test: pytest
  env_file: .env
ignore:
  - __pycache__
  - .git
  - .venv
  - bot.log
  - video_*.mp4
  - *.pyc
  - backups/**
instructions:
  - Всегда используй `billing.hold_and_start` / `on_success` / `on_error` для операций, чтобы списания и рефанды фиксировались корректно.
  - Для всех сетевых запросов предусматривай тайм-ауты (<=30s) и минимум 3 ретрая с экспоненциальной паузой.
  - Храни служебные ключи только в `.env` (не коммить реальные значения).
  - Используй `billing.hold_and_start` и `on_success/on_error` для любых генераций.
  - При добавлении новых команд Telegram регистрируй их и в reply, и в inline клавиатурах.
  - Документируй новые потоки в `ARCHITECTURE.md`.
